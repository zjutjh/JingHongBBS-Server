(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{1111:function(e,t,n){"use strict";n.r(t);n(11);var r=n(732),o=n.n(r),time=n(742),l={name:"Invited",filters:{formatDate:function(e){return Object(time.b)(e)}},mixins:[o.a],props:{groupMap:{type:Object,default:function(){return{}}}},data:function(){return{loading:!1,selectedStatus:"",handleValue:"",pageNum:1,pageSize:10,searchText:"",sort:"-created_at",inviteTotal:0,totalMoney:0,total:0,inviteList:[]}},computed:{userId:function(){return this.$store.state.user.info.id},forums:function(){return this.$store.state.site.info.attributes||{}}},watch:{userId:function(e){e&&0===this.totalMoney&&this.getIncome()}},mounted:function(){this.getInvite(),this.getIncome(),this.getInviteList()},methods:{getInvite:function(){var e=this;this.$store.dispatch("jv/get",["invite/users",{params:{"page[number]":1,"page[limit]":1}}]).then((function(t){t&&t._jv&&t._jv.json&&t._jv.json.meta&&(e.inviteTotal=t._jv.json.meta.total)}))},getIncome:function(){var e=this;if(this.userId){var t={"filter[user]":this.userId,"filter[change_type]":"33, 62, 34","page[number]":1,"page[limit]":1};this.$store.dispatch("jv/get",["wallet/log",{params:t}]).then((function(t){t&&t._jv&&t._jv.json&&t._jv.json.meta&&(e.totalMoney=t._jv.json.meta.sumChangeAvailableAmount)}))}},getInviteList:function(){var e=this;this.loading=!0;var t={"page[number]":this.pageNum,"page[limit]":this.pageSize,"filter[username]":this.searchText,sort:this.sort};this.$store.dispatch("jv/get",["invite/users",{params:t}]).then((function(t){t&&(e.inviteList=t,t._jv&&t._jv.json&&t._jv.json.meta&&(e.total=t._jv.json.meta.total))}),(function(t){e.handleError(t)})).finally((function(){e.loading=!1}))},createUserInvite:function(){var e=this;if(!(this.forums&&this.forums.other&&this.forums.other.can_invite_user_scale))return this.$message.error(this.$t("core.permission_denied"));this.$store.dispatch("jv/get",{_jv:{type:"userInviteCode"}}).then((function(t){t&&t._jv&&e.copyLink(t._jv.code)}),(function(t){e.handleError(t)})).finally((function(){e.loading=!1}))},viewDetail:function(e){this.$emit("view-detail",e)},copyLink:function(code){var e=document.createElement("input");e.value="".concat(window.location.protocol,"//").concat(window.location.host,"/site/partner-invite?code=").concat(code),e.id="copyInput",document.body.appendChild(e),e.select(),document.execCommand("Copy"),this.$message.success(this.$t("discuzq.msgBox.copySuccess")),setTimeout((function(){e.remove()}),100)},sortChange:function(e){var t=e.order;this.sort="descending"===t?"-created_at":"ascending"===t?"created_at":"",this.getInviteList()},onClickSearch:function(){this.pageNum=1,this.getInviteList()},handleSizeChange:function(e){this.pageNum=1,this.pageSize=e,this.getInviteList()},handleCurrentChange:function(e){this.pageNum=e,this.getInviteList()}}},c=(n(983),n(12)),component=Object(c.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user-manage"},[n("div",{staticClass:"filter-cont"},[n("div",{staticClass:"content"},[e.loading?e._e():[e._v("\n        "+e._s(e.$t("invite.inviteTotal"))+"\n        "),n("span",{staticClass:"bold"},[e._v(e._s(e.inviteTotal))]),e._v("\n        "+e._s(e.$t("invite.people"))+"\n        "+e._s(e.$t("invite.allIncome"))+"\n        "),n("span",{staticClass:"bold"},[e._v(e._s(e.$t("post.yuanItem")+e.totalMoney))])]],2),e._v(" "),n("el-input",{staticClass:"search",attrs:{placeholder:e.$t("invite.searchPlaceholder"),size:"medium"},on:{input:e.onClickSearch},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onClickSearch(t)}},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[n("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),e._v(" "),n("el-button",{staticClass:"create-url",attrs:{type:"primary",size:"medium"},on:{click:e.createUserInvite}},[e._v(e._s(e.$t("manage.generateInvitationUrl")))])],1),e._v(" "),n("div",{staticClass:"main"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",attrs:{data:e.inviteList,"default-sort":{prop:"created_at",order:"descending"}},on:{"sort-change":e.sortChange}},[n("el-table-column",{attrs:{label:e.$t("invite.inviteUserName")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.user?n("div",{staticClass:"flex"},[n("avatar",{attrs:{user:{id:t.row.user.id,username:t.row.user.username,avatarUrl:t.row.user.avatarUrl},size:30,round:!0}}),e._v(" "),n("nuxt-link",{staticClass:"user-name",attrs:{to:"/user/"+t.row.user.id}},[e._v(e._s(t.row.user.username))])],1):e._e()]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"created_at",label:e.$t("invite.createdAt"),sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDate")(t.row.created_at))+"\n        ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("manage.operate"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return n("div",{staticClass:"last-table"},[n("el-button",{staticClass:"btn",attrs:{type:"text"},on:{click:function(n){return e.viewDetail(t.row)}}},[e._v(e._s(e.$t("invite.viewDetail")))])],1)}}])})],1)],1),e._v(" "),n("div",{staticClass:"pagination"},[n("el-pagination",{attrs:{background:"","hide-on-single-page":"","pager-count":5,"current-page":e.pageNum,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])}),[],!1,null,"0924599b",null);t.default=component.exports;installComponents(component,{Avatar:n(268).default})},1112:function(e,t,n){"use strict";n.r(t);n(11);var r=n(732),o=n.n(r),time=n(742),l={name:"Income",filters:{formatDate:function(e){return Object(time.b)(e)}},mixins:[o.a],props:{groupMap:{type:Object,default:function(){return{}}}},data:function(){return{loading:!1,pageNum:1,pageSize:10,searchText:"",sort:"-created_at",total:0,incomeList:[],totalMoney:0}},computed:{userId:function(){return this.$store.state.user.info.id},forums:function(){return this.$store.state.site.info.attributes||{}}},watch:{userId:function(e){e&&0===this.incomeList.length&&this.getIncomeList()}},mounted:function(){this.getIncomeList()},methods:{getIncomeList:function(){var e=this;if(this.userId){this.loading=!0;var t={include:"sourceUser","filter[user]":this.userId,"filter[change_type]":"33, 62, 34","page[number]":this.pageNum,"page[limit]":this.pageSize,"filter[source_username]":this.searchText,sort:this.sort};this.$store.dispatch("jv/get",["wallet/log",{params:t}]).then((function(t){t&&t._jv&&t._jv.json&&t._jv.json.meta&&(e.totalMoney=t._jv.json.meta.sumChangeAvailableAmount,e.total=t._jv.json.meta.total),e.incomeList=t}),(function(t){e.handleError(t)})).finally((function(){e.loading=!1}))}},createUserInvite:function(){var e=this;if(!(this.forums&&this.forums.other&&this.forums.other.can_invite_user_scale))return this.$message.error(this.$t("core.permission_denied"));this.$store.dispatch("jv/get",{_jv:{type:"userInviteCode"}}).then((function(t){t&&t._jv&&e.copyLink(t._jv.code)}),(function(t){e.handleError(t)})).finally((function(){e.loading=!1}))},copyLink:function(code){var e=document.createElement("input");e.value="".concat(window.location.protocol,"//").concat(window.location.host,"/site/partner-invite?code=").concat(code),e.id="copyInput",document.body.appendChild(e),e.select(),document.execCommand("Copy"),this.$message.success(this.$t("discuzq.msgBox.copySuccess")),setTimeout((function(){e.remove()}),100)},sortChange:function(e){var t=e.order;this.sort="descending"===t?"-created_at":"ascending"===t?"created_at":"",this.getIncomeList()},onClickSearch:function(){this.pageNum=1,this.getIncomeList()},handleSizeChange:function(e){this.pageNum=1,this.pageSize=e,this.getIncomeList()},handleCurrentChange:function(e){this.pageNum=e,this.getIncomeList()}}},c=(n(984),n(12)),component=Object(c.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user-manage"},[n("div",{staticClass:"filter-cont"},[n("div",{staticClass:"content"},[e.loading?e._e():[e._v("\n        "+e._s(e.$t("invite.incomeTotal"))+"\n        "),n("span",{staticClass:"bold"},[e._v(e._s(e.$t("post.yuanItem")+e.totalMoney))])]],2),e._v(" "),n("el-input",{staticClass:"search",attrs:{placeholder:e.$t("invite.searchPlaceholder"),size:"medium"},on:{input:e.onClickSearch},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onClickSearch(t)}},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[n("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),e._v(" "),n("el-button",{staticClass:"create-url",attrs:{type:"primary",size:"medium"},on:{click:e.createUserInvite}},[e._v(e._s(e.$t("manage.generateInvitationUrl")))])],1),e._v(" "),n("div",{staticClass:"main"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",attrs:{data:e.incomeList,"default-sort":{prop:"created_at",order:"descending"}},on:{"sort-change":e.sortChange}},[n("el-table-column",{attrs:{label:e.$t("invite.inviteUserName")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.sourceUser&&t.row.sourceUser.username?n("div",{staticClass:"flex"},[n("avatar",{attrs:{user:{id:t.row.sourceUser.id,username:t.row.sourceUser.username,avatarUrl:t.row.sourceUser.avatarUrl},size:30,round:!0}}),e._v(" "),n("nuxt-link",{staticClass:"user-name",attrs:{to:"/user/"+t.row.sourceUser.id}},[e._v(e._s(t.row.sourceUser.username))])],1):[e._v(e._s(e.$t("core.userDeleted")))]]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"created_at",label:e.$t("invite.incomeAt"),sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDate")(t.row.created_at))+"\n        ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("invite.income"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return n("div",{staticClass:"last-table"},[e._v("\n          "+e._s(e.$t("post.yuanItem")+t.row.change_available_amount)+"\n        ")])}}])})],1)],1),e._v(" "),n("div",{staticClass:"pagination"},[n("el-pagination",{attrs:{background:"","hide-on-single-page":"","pager-count":5,"current-page":e.pageNum,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])}),[],!1,null,"3ffadf10",null);t.default=component.exports;installComponents(component,{Avatar:n(268).default})},1142:function(e,t,n){"use strict";n.r(t);n(11);var time=n(742),head=n(733),r={layout:"center_layout",name:"InviteExtension",filters:{formatDate:function(e){return Object(time.b)(e)}},mixins:[n.n(head).a],data:function(){return{title:this.$t("invite.invite"),loading:!1,activeName:"invited",isShowDetail:!1,detail:{},pageNum:1,pageSize:10,total:0,detailTotalMoney:0,detailUserId:"",incomeDetailList:[]}},computed:{userId:function(){return this.$store.state.user.info.id}},mounted:function(){},methods:{viewDetail:function(e){this.detail=e,this.isShowDetail=!0,this.detailUserId=e.user_id,this.getIncomeDetailList()},getIncomeDetailList:function(){var e=this;if(this.userId){this.loading=!0;var t={include:"sourceUser","filter[user]":this.userId,"filter[change_type]":"33, 62, 34","page[number]":this.pageNum,"page[limit]":this.pageSize,sort:this.sort,"filter[source_user_id]":this.detailUserId};this.$store.dispatch("jv/get",["wallet/log",{params:t}]).then((function(t){t&&t._jv&&t._jv.json&&t._jv.json.meta&&(e.detailTotalMoney=t._jv.json.meta.sumChangeAvailableAmount,e.total=t._jv.json.meta.total),e.incomeDetailList=t}),(function(t){e.handleError(t)})).finally((function(){e.loading=!1}))}},sortChange:function(e){var t=e.order;this.sort="descending"===t?"-created_at":"ascending"===t?"created_at":"",this.getIncomeDetailList()},handleSizeChange:function(e){this.pageNum=1,this.pageSize=e,this.getIncomeDetailList()},handleCurrentChange:function(e){this.pageNum=e,this.getIncomeDetailList()}}},o=(n(982),n(12)),component=Object(o.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"invite-container"},[e.isShowDetail?[e.detail&&e.detail.user?n("header",{staticClass:"detail-header"},[n("div",{staticClass:"title"},[e._v(e._s(e.$t("invite.userDetail")))]),e._v(" "),n("div",{staticClass:"user"},[n("avatar",{attrs:{user:{id:e.detail.user.id,username:e.detail.user.username,avatarUrl:e.detail.user.avatarUrl},size:50}}),e._v(" "),n("div",{staticClass:"user-info"},[n("nuxt-link",{staticClass:"user-name",attrs:{to:"/user/"+e.detail.user.id}},[e._v("\n            "+e._s(e.detail.user.username)+"\n          ")]),e._v(" "),n("div",{staticClass:"create-at"},[e._v("\n            "+e._s(e.$t("invite.createdAt")+e.$t("discuzq.symbol.colon"))+" "+e._s(e._f("formatDate")(e.detail.created_at))+"\n          ")])],1),e._v(" "),n("div",{staticClass:"total-money"},[n("div",{staticClass:"label"},[e._v(e._s(e.$t("invite.allIncome")))]),e._v(" "),n("div",{staticClass:"value"},[e._v(e._s(e.$t("post.yuanItem")+e.detailTotalMoney))])])],1)]):e._e(),e._v(" "),n("main",[n("div",{staticClass:"main"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.incomeDetailList,"default-sort":{prop:"created_at",order:"descending"}},on:{"sort-change":e.sortChange}},[n("el-table-column",{attrs:{label:e.$t("invite.inviteUserName")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.sourceUser?n("div",{staticClass:"flex"},[n("avatar",{attrs:{user:{id:t.row.sourceUser.id,username:t.row.sourceUser.username,avatarUrl:t.row.sourceUser.avatarUrl},size:30,round:!0}}),e._v(" "),n("nuxt-link",{staticClass:"user-name",attrs:{to:"/user/"+t.row.sourceUser.id}},[e._v("\n                  "+e._s(t.row.sourceUser.username))])],1):e._e()]}}],null,!1,2955613281)}),e._v(" "),n("el-table-column",{attrs:{prop:"created_at",label:e.$t("invite.incomeAt"),sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(e._f("formatDate")(t.row.created_at))+"\n            ")]}}],null,!1,419549433)}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("invite.income"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return n("div",{staticClass:"last-table"},[e._v("\n              "+e._s(e.$t("post.yuanItem")+t.row.change_available_amount)+"\n            ")])}}],null,!1,3286361409)})],1)],1),e._v(" "),n("div",{staticClass:"pagination"},[n("el-pagination",{attrs:{background:"","hide-on-single-page":"","pager-count":5,"current-page":e.pageNum,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])]:n("div",{staticClass:"invite-cont"},[n("main",[n("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:e.$t("invite.invitedUser"),name:"invited"}},[n("invited",{on:{"view-detail":e.viewDetail}})],1),e._v(" "),n("el-tab-pane",{attrs:{label:e.$t("invite.incomeDetail"),name:"income"}},[n("income")],1)],1)],1)])],2)}),[],!1,null,"ce1678f2",null);t.default=component.exports;installComponents(component,{Avatar:n(268).default,Header:n(123).default,Invited:n(1111).default,Income:n(1112).default})},732:function(e,t,n){n(32);var r=n(714);n(51),e.exports={data:function(){var e=this;return{errorCodeHandler:{default:{model_not_found:function(){return e.$router.replace("/error")},not_authenticated:function(){return e.$router.push("/user/login")}},thread:{permission_denied:function(){return e.$router.replace("/error")}}}}},methods:{handleError:function(e){var t=arguments,n=this;return r(regeneratorRuntime.mark((function r(){var o,l,c,d,v,m;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=t.length>1&&void 0!==t[1]?t[1]:"",l=e.response.data.errors,!(Array.isArray(l)&&l.length>0)){r.next=17;break}if(c=l[0].code,d=l[0].detail&&l[0].detail.length>0?l[0].detail[0]:l[0].code,v=l[0].detail&&l[0].detail.length>0?l[0].detail[0]:n.$t("core.".concat(d)),"site_closed"!==l[0].code){r.next=10;break}return r.next=9,n.siteClose(l);case 9:return r.abrupt("return",r.sent);case 10:if("need_ext_fields"!==l[0].code){r.next=14;break}return m=n.$store.getters["session/get"]("userId"),n.$router.push("/user/supple-mentary?id=".concat(m)),r.abrupt("return");case 14:"Permission Denied"===c?n.$message.error(n.$t("core.permission_denied2")):n.$message.error(v),n.errorCodeHandler.default[c]&&n.errorCodeHandler.default[c](),o&&n.errorCodeHandler[o][c]&&n.errorCodeHandler[o][c]();case 17:case"end":return r.stop()}}),r)})))()},siteClose:function(e){var t=this;return r(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.$store.dispatch("forum/setError",{code:e[0].code,detail:e[0].detail&&e[0].detail.length>0&&e[0].detail[0]});case 3:return n.next=5,t.$router.push("/site/close");case 5:n.next=9;break;case 7:n.prev=7,n.t0=n.catch(0);case 9:case"end":return n.stop()}}),n,null,[[0,7]])})))()}}}},733:function(e,t){e.exports={data:function(){return{title:"‎"}},computed:{forums:function(){return this.$store.state.site.info.attributes||{}}},head:function(){return{title:"‎"!==this.title&&this.forums&&this.forums.set_site&&this.forums.set_site.site_name?"".concat(this.title," - ").concat(this.forums.set_site.site_name):this.title}}}},742:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return l}));n(177),n(51);var r=function(time){var e=(window.currentTime||new Date)-new Date(time);return parseInt(parseInt(e/1e3,0)/60,0)<60?"".concat(Math.ceil(e/1e3/60)>0?Math.ceil(e/1e3/60):1,"分钟前"):parseInt(parseInt(parseInt(e/1e3,0)/60,0)/60,0)<16?"".concat(Math.ceil(e/1e3/60/60)>0?Math.ceil(e/1e3/60/60):1,"小时前"):time.replace(/T/," ").replace(/Z/,"").substring(0,16)},o=function(e){var t=e-Math.round(new Date/1e3);return parseInt(t/86400,0)},l=function(e){var t=Math.round(new Date(e)/1e3),n=Math.round(new Date/1e3)-t,r=parseInt(n/86400,0);if(r>365){var o=parseInt(n/86400/365,0);return"".concat(o,"年")}return"".concat(r,"天")}},876:function(e,t,n){},877:function(e,t,n){},878:function(e,t,n){},982:function(e,t,n){"use strict";var r=n(876);n.n(r).a},983:function(e,t,n){"use strict";var r=n(877);n.n(r).a},984:function(e,t,n){"use strict";var r=n(878);n.n(r).a}}]);