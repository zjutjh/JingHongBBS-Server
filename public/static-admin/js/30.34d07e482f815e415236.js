(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{"3JVg":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=d(i("4gYi")),a=d(i("Dt3C")),n=d(i("rWG0")),r=d(i("7qpD")),o=d(i("VVfg")),l=d(i("CKnL")),c=d(i("6NK7"));function d(e){return e&&e.__esModule?e:{default:e}}t.default={data:function(){return{searchUserName:"",keyWords:"",operator:"",categoriesList:[],categoriesListSelect:"",pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-7776e6),e.$emit("pick",[i,t])}}]},releaseTime:["",""],deleteTime:["",""],radioList:"",deleteStatusList:[],appleAll:!1,themeList:[],currentPaga:1,total:0,pageCount:1,submitForm:[],showViewer:!1,url:[],subLoading:!1,btnLoading:0,visible:!1}},methods:{titleIcon:function(e){return c.default.titleIcon(e)},imgShowClick:function(e,t){var i=this;this.url=[];var s=[];e.forEach((function(e){s.push(e._data.url)})),this.url.push(s[t]),s.forEach((function(e,s){s>t&&i.url.push(e)})),s.forEach((function(e,s){s<t&&i.url.push(e)})),this.showViewer=!0},closeViewer:function(){this.showViewer=!1},radioChange:function(e,t){switch(e){case"还原":this.submitForm[t].attributes.isDeleted=!1,this.submitForm[t].hardDelete=!1;break;case"删除":this.submitForm[t].hardDelete=!0}},searchClick:function(){this.currentPaga=1,this.getPostsList(1)},handleCurrentChange:function(e){document.getElementsByClassName("index-main-con__main")[0].scrollTop=0,o.default.setLItem("currentPag",e),this.currentPaga=e,this.getPostsList(e)},submitClick:function(){var e=this;this.subLoading=!0,this.deleteStatusList=[];var t=[];this.submitForm.forEach((function(i,s){i.hardDelete&&e.deleteStatusList.push(i.id),i.attributes.isDeleted||t.push(i.id)})),this.deleteStatusList.length>0&&this.deletePostsBatch(this.deleteStatusList.join(",")),t.length>0&&this.patchPostsBatch(this.submitForm)},allOperationsSubmit:function(e){var t=this;this.btnLoading=e;var i="";switch(e){case 1:this.submitForm.forEach((function(e,i){t.submitForm[i].attributes.isDeleted=!1})),this.patchPostsBatch(this.submitForm);break;case 2:this.submitForm.forEach((function(e,s){s<t.submitForm.length-1?i=i+e.id+",":i+=e.id})),this.deletePostsBatch(i)}},formatDate:function(e){return this.$dayjs(e).format("YYYY-MM-DD HH:mm")},getPostsList:function(e){var t=this;this.appFetch({url:"posts",method:"get",data:{include:["user","replyUser","thread","thread.category","thread.firstPost","deletedUser","lastDeletedLog","images"],"filter[isDeleted]":"yes","filter[username]":this.searchUserName,"page[number]":e,"page[size]":10,"filter[q]":this.keyWords,"filter[categoryId]":this.categoriesListSelect,"filter[deletedUsername]":this.operator,"filter[createdAtBegin]":this.releaseTime[0],"filter[createdAtEnd]":this.releaseTime[1],"filter[deletedAtBegin]":this.deleteTime[0],"filter[deletedAtEnd]":this.deleteTime[1],sort:"-deletedAt"}}).then((function(e){e.errors?t.$message.error(e.errors[0].code):(t.themeList=[],t.submitForm=[],t.themeList=e.readdata,t.total=e.meta.postCount,t.pageCount=e.meta.pageCount,t.themeList.forEach((function(e,i){t.submitForm.push({Select:"无",radio:"",type:"posts",id:e._data.id,attributes:{isDeleted:!0,message:""}})})))})).catch((function(e){}))},getCategories:function(){var e=this;this.appFetch({url:"categories",method:"get",data:{}}).then((function(t){t.errors?e.$message.error(t.errors[0].code):(e.categoriesList=[],t.data.forEach((function(t,i){e.categoriesList.push({name:t.attributes.name,id:t.id})})))})).catch((function(e){}))},patchPostsBatch:function(e){var t=this;this.appFetch({url:"postsBatch",method:"patch",data:{data:e}}).then((function(e){t.subLoading=!1,t.btnLoading=0,e.errors?t.$message.error(e.errors[0].code):e.meta&&e.data?t.$message.error("操作失败！"):(t.getPostsList(Number(o.default.getLItem("currentPag"))||1),t.$message({message:"操作成功",type:"success"}))})).catch((function(e){}))},patchPosts:function(e,t){var i=this;this.appFetch({url:"threads",method:"patch",splice:"/"+t,data:{data:e}}).then((function(e){i.subLoading=!1,i.btnLoading=0,e.errors?i.$message.error(e.errors[0].code):e.meta&&e.data?(i.checkedTheme=[],i.$message.error("操作失败！")):(i.getPostsList(Number(o.default.getLItem("currentPag"))||1),i.$message({message:"操作成功",type:"success"}))})).catch((function(e){}))},deletePostsBatch:function(e){var t=this;this.appFetch({url:"postBatch",method:"delete",splice:"/"+e}).then((function(e){t.subLoading=!1,t.btnLoading=0,e.meta?e.meta.forEach((function(e,i){setTimeout((function(){t.$message.error(e.code)}),500*(i+1))})):(t.getPostsList(Number(o.default.getLItem("currentPag"))||1),t.$message({message:"操作成功",type:"success"}))})).catch((function(e){}))},getCreated:function(e){e?this.getPostsList(1):this.getPostsList(Number(o.default.getLItem("currentPag"))||1)}},created:function(){this.getCategories()},beforeRouteEnter:function(e,t,i){i((function(i){e.name!==t.name&&null!==t.name?i.getCreated(!0):i.getCreated(!1)}))},components:{Card:s.default,ContArrange:a.default,Page:n.default,tableNoList:r.default,ElImageViewer:l.default}}},"6cHu":function(e,t,i){"use strict";i.r(t);var s=i("95IW"),a=i.n(s);for(var n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(n);t.default=a.a},"95IW":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i("QbLZ"));i("lL+3");var a=n(i("3JVg"));function n(e){return e&&e.__esModule?e:{default:e}}t.default=(0,s.default)({name:"recycle-bin-reply-view"},a.default)},CKnL:function(e,t,i){"use strict";i.r(t);var s=i("i7/w"),a=i.n(s);const n=a.a.prototype.$isServer,r=(n||Number(document.documentMode),!n&&document.addEventListener?function(e,t,i){e&&t&&i&&e.addEventListener(t,i,!1)}:function(e,t,i){e&&t&&i&&e.attachEvent("on"+t,i)}),o=!n&&document.removeEventListener?function(e,t,i){e&&t&&e.removeEventListener(t,i,!1)}:function(e,t,i){e&&t&&e.detachEvent("on"+t,i)};Object.prototype.hasOwnProperty;function l(e){let t=!1;return function(...i){t||(t=!0,window.requestAnimationFrame(s=>{e.apply(this,i),t=!1}))}}const c={CONTAIN:{name:"contain",icon:"el-icon-full-screen"},ORIGINAL:{name:"original",icon:"el-icon-c-scale-to-original"}},d=!a.a.prototype.$isServer&&window.navigator.userAgent.match(/firefox/i)?"DOMMouseScroll":"mousewheel";var u={name:"elImageViewer",props:{urlList:{type:Array,default:()=>[]},zIndex:{type:Number,default:2e3},onSwitch:{type:Function,default:()=>{}},onClose:{type:Function,default:()=>{}},initialIndex:{type:Number,default:0},appendToBody:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0}},data(){return{index:this.initialIndex,isShow:!1,infinite:!0,loading:!1,mode:c.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}},computed:{isSingle(){return this.urlList.length<=1},isFirst(){return 0===this.index},isLast(){return this.index===this.urlList.length-1},currentImg(){return this.urlList[this.index]},imgStyle(){const{scale:e,deg:t,offsetX:i,offsetY:s,enableTransition:a}=this.transform,n={transform:`scale(${e}) rotate(${t}deg)`,transition:a?"transform .3s":"","margin-left":i+"px","margin-top":s+"px"};return this.mode===c.CONTAIN&&(n.maxWidth=n.maxHeight="100%"),n}},watch:{index:{handler:function(e){this.reset(),this.onSwitch(e)}},currentImg(e){this.$nextTick(e=>{this.$refs.img[0].complete||(this.loading=!0)})}},methods:{hide(){this.deviceSupportUninstall(),this.onClose()},deviceSupportInstall(){this._keyDownHandler=l(e=>{switch(e.keyCode){case 27:this.hide();break;case 32:this.toggleMode();break;case 37:this.prev();break;case 38:this.handleActions("zoomIn");break;case 39:this.next();break;case 40:this.handleActions("zoomOut")}}),this._mouseWheelHandler=l(e=>{(e.wheelDelta?e.wheelDelta:-e.detail)>0?this.handleActions("zoomIn",{zoomRate:.015,enableTransition:!1}):this.handleActions("zoomOut",{zoomRate:.015,enableTransition:!1})}),r(document,"keydown",this._keyDownHandler),r(document,d,this._mouseWheelHandler)},deviceSupportUninstall(){o(document,"keydown",this._keyDownHandler),o(document,d,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad(e){this.loading=!1},handleImgError(e){this.loading=!1,e.target.alt="加载失败"},handleMouseDown(e){if(this.loading||0!==e.button)return;const{offsetX:t,offsetY:i}=this.transform,s=e.pageX,a=e.pageY;this._dragHandler=l(e=>{this.transform.offsetX=t+e.pageX-s,this.transform.offsetY=i+e.pageY-a}),r(document,"mousemove",this._dragHandler),r(document,"mouseup",e=>{o(document,"mousemove",this._dragHandler)}),e.preventDefault()},handleMaskClick(){this.maskClosable&&this.hide()},reset(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},toggleMode(){if(this.loading)return;const e=Object.keys(c),t=(Object.values(c).indexOf(this.mode)+1)%e.length;this.mode=c[e[t]],this.reset()},prev(){if(this.isFirst&&!this.infinite)return;const e=this.urlList.length;this.index=(this.index-1+e)%e},next(){if(this.isLast&&!this.infinite)return;const e=this.urlList.length;this.index=(this.index+1)%e},handleActions(e,t={}){if(this.loading)return;const{zoomRate:i,rotateDeg:s,enableTransition:a}={zoomRate:.2,rotateDeg:90,enableTransition:!0,...t},{transform:n}=this;switch(e){case"zoomOut":n.scale>.2&&(n.scale=parseFloat((n.scale-i).toFixed(3)));break;case"zoomIn":n.scale=parseFloat((n.scale+i).toFixed(3));break;case"clocelise":n.deg+=s;break;case"anticlocelise":n.deg-=s}n.enableTransition=a}},mounted(){this.deviceSupportInstall(),this.appendToBody&&document.body.appendChild(this.$el),this.$refs["el-image-viewer__wrapper"].focus()},destroyed(){this.appendToBody&&this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)}},h=i("KHd+"),m=Object(h.a)(u,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"viewer-fade"}},[i("div",{ref:"el-image-viewer__wrapper",staticClass:"el-image-viewer__wrapper",style:{"z-index":e.zIndex},attrs:{tabindex:"-1"}},[i("div",{staticClass:"el-image-viewer__mask",on:{click:function(t){return t.target!==t.currentTarget?null:e.handleMaskClick(t)}}}),e._v(" "),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:e.hide}},[i("i",{staticClass:"el-icon-close"})]),e._v(" "),e.isSingle?e._e():[i("span",{staticClass:"el-image-viewer__btn el-image-viewer__prev",class:{"is-disabled":!e.infinite&&e.isFirst},on:{click:e.prev}},[i("i",{staticClass:"el-icon-arrow-left"})]),e._v(" "),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__next",class:{"is-disabled":!e.infinite&&e.isLast},on:{click:e.next}},[i("i",{staticClass:"el-icon-arrow-right"})])],e._v(" "),i("div",{staticClass:"el-image-viewer__btn el-image-viewer__actions"},[i("div",{staticClass:"el-image-viewer__actions__inner"},[i("i",{staticClass:"el-icon-zoom-out",on:{click:function(t){return e.handleActions("zoomOut")}}}),e._v(" "),i("i",{staticClass:"el-icon-zoom-in",on:{click:function(t){return e.handleActions("zoomIn")}}}),e._v(" "),i("i",{staticClass:"el-image-viewer__actions__divider"}),e._v(" "),i("i",{class:e.mode.icon,on:{click:e.toggleMode}}),e._v(" "),i("i",{staticClass:"el-image-viewer__actions__divider"}),e._v(" "),i("i",{staticClass:"el-icon-refresh-left",on:{click:function(t){return e.handleActions("anticlocelise")}}}),e._v(" "),i("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.handleActions("clocelise")}}})])]),e._v(" "),i("div",{staticClass:"el-image-viewer__canvas"},e._l(e.urlList,(function(t,s){return s===e.index?i("img",{key:t,ref:"img",refInFor:!0,staticClass:"el-image-viewer__img",style:e.imgStyle,attrs:{src:e.currentImg},on:{load:e.handleImgLoad,error:e.handleImgError,mousedown:e.handleMouseDown}}):e._e()})),0)],2)])}),[],!1,null,null,null);t.default=m.exports},"KHd+":function(e,t,i){"use strict";function s(e,t,i,s,a,n,r,o){var l,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=i,c._compiled=!0),s&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),r?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},c._ssrRegister=l):a&&(l=o?function(){a.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(e,t){return l.call(t),d(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,l):[l]}return{exports:e,options:c}}i.d(t,"a",(function(){return s}))},S6Kl:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"recycle-bin-reply-box"},[i("div",{staticClass:"recycle-bin-reply-header"},[i("div",{staticClass:"recycle-bin-reply-header__section"},[i("div",{staticClass:"section-top"},[i("span",{staticClass:"cont-review-header__lf-title"},[e._v("作者：")]),e._v(" "),i("el-input",{attrs:{size:"medium",clearable:"",placeholder:"搜索作者"},model:{value:e.searchUserName,callback:function(t){e.searchUserName=t},expression:"searchUserName"}})],1),e._v(" "),i("div",[i("span",{staticClass:"cont-review-header__lf-title"},[e._v("搜索范围：")]),e._v(" "),i("el-select",{attrs:{clearable:"",size:"medium",placeholder:"选择主题分类"},model:{value:e.categoriesListSelect,callback:function(t){e.categoriesListSelect=t},expression:"categoriesListSelect"}},e._l(e.categoriesList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)]),e._v(" "),i("div",{staticClass:"recycle-bin-reply-header__section"},[i("div",{staticClass:"section-top"},[i("span",{staticClass:"cont-review-header__lf-title"},[e._v("内容包含：")]),e._v(" "),i("el-input",{attrs:{size:"medium",clearable:"",placeholder:"搜索内容包含"},model:{value:e.keyWords,callback:function(t){e.keyWords=t},expression:"keyWords"}})],1),e._v(" "),i("div",[i("span",{staticClass:"cont-review-header__lf-title"},[e._v("操作人：")]),e._v(" "),i("el-input",{attrs:{size:"medium",clearable:"",placeholder:"搜索操作人"},model:{value:e.operator,callback:function(t){e.operator=t},expression:"operator"}})],1)]),e._v(" "),i("div",{staticClass:"recycle-bin-reply-header__section"},[i("div",{staticClass:"section-top"},[i("span",{staticClass:"cont-review-header__lf-title time-title"},[e._v("发布时间范围：")]),e._v(" "),i("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange",align:"right","unlink-panels":"",size:"medium","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.releaseTime,callback:function(t){e.releaseTime=t},expression:"releaseTime"}})],1),e._v(" "),i("div",[i("span",{staticClass:"cont-review-header__lf-title time-title"},[e._v("删除时间范围：")]),e._v(" "),i("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange",align:"right","unlink-panels":"",size:"medium","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.deleteTime,callback:function(t){e.deleteTime=t},expression:"deleteTime"}})],1)]),e._v(" "),i("div",{staticClass:"recycle-bin-reply-header__section"},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.searchClick}},[e._v("搜索")])],1)]),e._v(" "),i("div",{staticClass:"recycle-bin-reply-table"},[e._l(e.themeList,(function(t,s){return i("ContArrange",{key:t._data.id,attrs:{replyBy:t.user?t.user._data.username:"该用户被删除",themeName:1===t.thread._data.type?t.thread._data.title:t.thread.firstPost._data.content,titleIcon:e.titleIcon(t.thread._data),finalPost:e.formatDate(t._data.createdAt),deleTime:e.formatDate(t._data.deletedAt),ip:t._data.ip,userId:t.user?t.user._data.id:"该用户被删除"}},[i("div",{staticClass:"recycle-bin-reply-table__side",attrs:{slot:"side"},slot:"side"},[i("el-radio-group",{on:{change:function(t){return e.radioChange(t,s)}},model:{value:e.submitForm[s].radio,callback:function(t){e.$set(e.submitForm[s],"radio",t)},expression:"submitForm[index].radio"}},[i("el-radio",{attrs:{label:"还原"}}),e._v(" "),i("el-radio",{attrs:{label:"删除"}})],1)],1),e._v(" "),i("div",{staticClass:"recycle-bin-reply-table__main",attrs:{slot:"main"},slot:"main"},[i("a",{staticClass:"recycle-bin-reply-table__main__cont-text",attrs:{href:"/topic/index?id="+t.thread._data.id,target:"_blank"},domProps:{innerHTML:e._s(t._data.contentHtml)}}),e._v(" "),i("div",{staticClass:"recycle-bin-reply-table__main__cont-imgs"},e._l(t.images,(function(s,a){return i("p",{key:a,staticClass:"recycle-bin-reply-table__main__cont-imgs-p"},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:s._data.thumbUrl,expression:"item._data.thumbUrl"}],attrs:{alt:s._data.fileName},on:{click:function(i){return e.imgShowClick(t.images,a)}}})])})),0)]),e._v(" "),i("div",{staticClass:"recycle-bin-reply-table__footer",attrs:{slot:"footer"},slot:"footer"},[i("div",{staticClass:"recycle-bin-reply-table__footer-operator"},[i("span",[e._v("操作者：")]),e._v(" "),i("span",[e._v(e._s(t.deletedUser?t.deletedUser._data.username:"操作者被禁止或删除"))])]),e._v(" "),t.lastDeletedLog._data.message.length>0?i("div",{staticClass:"recycle-bin-reply-table__footer-reason"},[i("span",[e._v("原因：")]),e._v(" "),i("span",[e._v(e._s(t.deletedUser?t.lastDeletedLog._data.message:"操作者被禁止或删除"))])]):e._e()])])})),e._v(" "),e.showViewer?i("el-image-viewer",{attrs:{"on-close":e.closeViewer,"url-list":e.url}}):e._e(),e._v(" "),i("tableNoList",{directives:[{name:"show",rawName:"v-show",value:e.themeList.length<1,expression:"themeList.length < 1"}]}),e._v(" "),e.pageCount>1?i("Page",{attrs:{"current-page":e.currentPaga,"page-size":10,total:e.total},on:{"current-change":e.handleCurrentChange}}):e._e()],2),e._v(" "),i("div",{staticClass:"recycle-bin-reply-footer footer-btn"},[i("el-button",{attrs:{size:"small",loading:e.subLoading,type:"primary"},on:{click:e.submitClick}},[e._v("提交")]),e._v(" "),i("el-button",{attrs:{type:"text",loading:1===e.btnLoading},on:{click:function(t){return e.allOperationsSubmit(1)}}},[e._v("全部还原")]),e._v(" "),i("el-popover",{attrs:{width:"100",placement:"top"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[i("p",[e._v("确定删除该项吗？")]),e._v(" "),i("div",{staticStyle:{"text-align":"right",margin:"10PX 0 0 0"}},[i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){e.visible=!1}}},[e._v("\n              取消\n            ")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.allOperationsSubmit(2),e.visible=!1}}},[e._v("确定")])],1),e._v(" "),i("el-button",{attrs:{slot:"reference",type:"text",loading:2===e.btnLoading},slot:"reference"},[e._v("全部删除")])],1)],1)])},a=[]},cj54:function(e,t,i){"use strict";i.r(t);var s=i("S6Kl"),a=i("6cHu");for(var n in a)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(n);var r=i("KHd+"),o=Object(r.a)(a.default,s.a,s.b,!1,null,null,null);t.default=o.exports}}]);